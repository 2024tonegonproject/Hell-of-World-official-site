<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ログイン処理中...</title>
</head>
<body>
<h2>ログイン処理中...</h2>

<script>
const url = new URL(location.href);
const privateCode = url.searchParams.get("privateCode");

if (!privateCode) {
  document.body.innerHTML = "認証コードがありません";
} else {
  fetch(`https://auth-api.itinerary.eu.org/auth/verifyToken/${privateCode}`)
    .then(r => r.json())
    .then(data => {
      if (data.valid) {
        localStorage.setItem("username", data.username);
        location.href = "https://2024tonegonproject.github.io/Hell-of-World-official-site/";
      } else {
        document.body.innerHTML = "ログイン失敗しました";
      }
    })
    .catch(err => {
      document.body.innerHTML = "エラーが発生しました";
      console.error(err);
    });
}
</script>

</body>
</html>