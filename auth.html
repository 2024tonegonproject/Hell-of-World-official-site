<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Hell Of World公式ホームページ</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="/images/Icon.png">
</head>
<body>
<h2>ログイン処理中...</h2>
<script>
const url = new URL(location.href);
const privateCode = url.searchParams.get("privateCode");

if (!privateCode) {
  document.body.innerHTML = "認証コードがありません";
} else {
  fetch(`https://noisy-sound-60af.tgrk-2024tgproject-official.workers.dev/auth?privateCode=${privateCode}`)
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        document.body.innerHTML = `ログイン成功！ ユーザー名: ${data.username}`;
        setTimeout(() => {
          localStorage.setItem("username", data.username);
          location.href = "https://2024tonegonproject.github.io/Hell-of-World-official-site/"; 
        },100);
      }
    })
    .catch(err => {
      document.body.innerHTML = "エラーが発生しました";
      console.error(err);
    });
}
</script>
</body>
</html>