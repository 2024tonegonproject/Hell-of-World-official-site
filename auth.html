<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Hell Of World公式ホームページ</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="/images/Icon.png">
</head>
<body>
<h2>ログイン処理中...</h2>

<script>
const url = new URL(location.href);
const privateCode = url.searchParams.get("privateCode");
const publicCode = url.searchParams.get("publicCode");

if (!privateCode || !publicCode) {
  document.body.innerHTML = "認証コードがありません";
} else {
  fetch("https://noisy-sound-60af.tgrk-2024tgproject-official.workers.dev/auth", {
    method: "GET",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ privateCode, publicCode })
  })
  .then(r => r.json())
  .then(data => {
    console.log("Worker response:", data);

    if (data.ok) {
      localStorage.setItem("scratchUser", data.username);
      location.href = "https://2024tonegonproject.github.io/Hell-of-World-official-site/";
    } else {
      document.body.innerHTML = "ログイン失敗";
    }
  });
}
</script>
</body>
</html>